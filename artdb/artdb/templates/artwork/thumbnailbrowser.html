{% extends 'base.html' %}

{% block extra_scripts %}
{{ form.media }}
{% endblock extra_scripts %}

{% load search_tags %}

{% block thumbnailbrowser %}

<div class="thumbnail-area">
    {% if artworks %}

    <h2>all {{title}}</h2>

    <div id="searchbar">
        <form method="GET" action="">
            <input id="search_artworks_field" placeholder="Artworks" name="title" value="{{Â request.GET.title }}" autocomplete="off" type="search" role="title search"/><span id="clear_search_artwork_field">a</span><input id="search_artworks_submit" type="submit" value="Search"/>
        </form>
    </div>

    <div class="paginator">
        {{ artworks.has_previous }}
        {{ artworks.number }}
        {{ artworks.paginator.count }}
        {{ artworks.paginator.num_pages }}
        {{ artworks.paginator.page_range }}
        {{ artworks.has_next }}

        {% if artworks.has_previous %}
            <a href="?{% url_replace request 'page' 'page=1' %}"><<</a>
            <a href="?{% url_replace request 'page' artworks.previous_page_number %}"><</a>
        {% endif %}

        {% for num in artworks.paginator.page_range %}
            {% if artworks.number == num %}
                <span class="current-page">{{num}}</span>
            {% elif num > artworks.number|add:'-3' and num < artworks.number|add:'3' %}
                <a href="?{% url_replace request 'page' num %}">{{num}}</a>
            {% endif %}
        {% endfor %}

        {% if artworks.has_next %}
        <a href="?{% url_replace request 'page' artworks.next_page_number %}">></a>
            <a href="?{% url_replace request 'page' artworks.paginator.num_pages %}">>></a>
        {% endif %}
    </div>

    <div id="thumbnails">
        {% for artwork in artworks %}
        <div data-artworkid="{{artwork.id}}" class="thumbnail">
            <div class="vertically-center">
                {% if not artwork.imageOriginal %}
                    <div class="picture-thumbnail picture-thumbnail-missing"></div>
                {% else %}
                    <img class="picture-thumbnail" src="{{artwork.imageOriginal.thumbnail.180x180}}"/>
                {% endif %}
            </div>
            <div class="thumbnail-title">{{artwork.title}}</div>
            <div class="thumbnail-artist">
                {% for artist in artwork.artists.all %}
                    {{ artist.name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
        </div>        
    {% endfor %}
    </div>
    {% else %}
    <p>no artworks there</p>
    {% endif %}
</div>
test
<div class="sidebar-detached">
    <aside class="inspector" id="thumbnailbrowser-inspector">
        test
    </aside>
</div>

<script>
$(document).ready(function(){
    $("#search_artworks_field").autocomplete({
        source: function(request, response) {
            $.ajax({
            url: "http://localhost:8000/artwork-autocomplete/",
            dataType: "json",
            data: {
                q: request.term
            },
            success: function(data) {
                response($.map(data.results, function (item) {
                    return {
                        label: item.text,
                        value: item.id
                    }
                }));
            }
            });
        },
        select: function(event, ui) {
            var item = ui.item;
            if(item) {
                $(this).val(item.value);
                $(this.form).submit();
            }
        },
        minLength: 3,
        selectFirst: false
    });
});
</script>
{% endblock thumbnailbrowser %}